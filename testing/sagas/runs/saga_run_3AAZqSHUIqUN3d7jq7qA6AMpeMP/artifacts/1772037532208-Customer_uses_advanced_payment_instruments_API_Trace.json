{
  "stepKey": "customer-advanced-payment-flow",
  "callCount": 3,
  "calls": [
    {
      "method": "POST",
      "path": "/api/v1/public/bizes/3AAZqc9VQhE50e7Dx8433kahhOP/booking-orders/booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy/payments/advanced",
      "status": 201,
      "requestBody": {
        "tipMinor": 500,
        "tenders": [
          {
            "methodType": "card",
            "allocatedMinor": 10000,
            "label": "Primary card"
          },
          {
            "methodType": "cash",
            "allocatedMinor": 5500,
            "label": "Cash supplement"
          }
        ],
        "metadata": {
          "source": "rerun-sagas"
        }
      },
      "responseBody": {
        "success": true,
        "data": {
          "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
          "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
          "status": "succeeded",
          "currency": "USD",
          "amountTargetMinor": 15500,
          "amountCapturedMinor": 15500,
          "tenderCount": 2,
          "lineAllocationCount": 3,
          "transactionCount": 2
        },
        "meta": {
          "requestId": "2a3bb590-6a20-459d-b315-41fe63566f8d",
          "timestamp": "2026-02-25T16:38:52.153Z"
        }
      },
      "at": "2026-02-25T16:38:52.157Z"
    },
    {
      "method": "GET",
      "path": "/api/v1/bizes/3AAZqc9VQhE50e7Dx8433kahhOP/payment-intents?bookingOrderId=booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
      "status": 200,
      "responseBody": {
        "success": true,
        "data": [
          {
            "id": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
            "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
            "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
            "crossBizOrderId": null,
            "paymentProcessorAccountId": "pay_proc_account_3AAZrJp5Tw0mDwHf4220vU6Kkxz",
            "status": "succeeded",
            "currency": "USD",
            "amountTargetMinor": 15500,
            "amountCapturedMinor": 15500,
            "amountRefundedMinor": 0,
            "requiresCapture": false,
            "providerIntentRef": null,
            "source": "public_checkout",
            "authorizedAt": null,
            "capturedAt": "2026-02-25T16:38:52.117Z",
            "failedAt": null,
            "amountSnapshot": {
              "tipMinor": 500,
              "bookingTotalMinor": 15000,
              "expectedTotalMinor": 15500
            },
            "metadata": {
              "source": "rerun-sagas"
            },
            "createdAt": "2026-02-25T16:38:52.117Z",
            "updatedAt": "2026-02-25T16:38:52.117Z",
            "deletedAt": null,
            "createdBy": null,
            "updatedBy": null,
            "deletedBy": null
          }
        ],
        "meta": {
          "requestId": "28d2ef4c-f0c2-4a83-89c3-2fee68143fa3",
          "timestamp": "2026-02-25T16:38:52.171Z"
        },
        "pagination": {
          "page": 1,
          "perPage": 20,
          "total": 1,
          "hasMore": false
        }
      },
      "at": "2026-02-25T16:38:52.171Z"
    },
    {
      "method": "GET",
      "path": "/api/v1/bizes/3AAZqc9VQhE50e7Dx8433kahhOP/payment-intents/payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
      "status": 200,
      "responseBody": {
        "success": true,
        "data": {
          "intent": {
            "id": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
            "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
            "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
            "crossBizOrderId": null,
            "paymentProcessorAccountId": "pay_proc_account_3AAZrJp5Tw0mDwHf4220vU6Kkxz",
            "status": "succeeded",
            "currency": "USD",
            "amountTargetMinor": 15500,
            "amountCapturedMinor": 15500,
            "amountRefundedMinor": 0,
            "requiresCapture": false,
            "providerIntentRef": null,
            "source": "public_checkout",
            "authorizedAt": null,
            "capturedAt": "2026-02-25T16:38:52.117Z",
            "failedAt": null,
            "amountSnapshot": {
              "tipMinor": 500,
              "bookingTotalMinor": 15000,
              "expectedTotalMinor": 15500
            },
            "metadata": {
              "source": "rerun-sagas"
            },
            "createdAt": "2026-02-25T16:38:52.117Z",
            "updatedAt": "2026-02-25T16:38:52.117Z",
            "deletedAt": null,
            "createdBy": null,
            "updatedBy": null,
            "deletedBy": null
          },
          "tenders": [
            {
              "id": "intent_tender_3AAZrH0zltb2AmQtJq17qr1ViZX",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentMethodId": "payment_method_3AAZrGEm9bJlXrOe7KED0qaKorC",
              "giftInstrumentId": null,
              "methodType": "card",
              "allocatedMinor": 10000,
              "capturedMinor": 10000,
              "refundedMinor": 0,
              "sortOrder": 1,
              "externalTenderRef": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.129Z",
              "updatedAt": "2026-02-25T16:38:52.129Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "intent_tender_3AAZrMN0fH0NemUeBtDYDreOBNv",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentMethodId": "payment_method_3AAZrKFardwNVksqNByD8gt1CGN",
              "giftInstrumentId": null,
              "methodType": "cash",
              "allocatedMinor": 5500,
              "capturedMinor": 5500,
              "refundedMinor": 0,
              "sortOrder": 2,
              "externalTenderRef": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.134Z",
              "updatedAt": "2026-02-25T16:38:52.134Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ],
          "lineAllocations": [
            {
              "id": "intent_line_alloc_3AAZrGoZ2PutPqAbixIbX381z3w",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentIntentTenderId": "intent_tender_3AAZrH0zltb2AmQtJq17qr1ViZX",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "bookingOrderLineId": "booking_line_3AAZrNPqnuCeSYXqsfz76pHgUzw",
              "allocatedMinor": 10000,
              "capturedMinor": 10000,
              "refundedMinor": 0,
              "sortOrder": 1,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.138Z",
              "updatedAt": "2026-02-25T16:38:52.138Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "intent_line_alloc_3AAZrM1DCzx6YnsXNNzALlILNM4",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentIntentTenderId": "intent_tender_3AAZrMN0fH0NemUeBtDYDreOBNv",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "bookingOrderLineId": "booking_line_3AAZrNPqnuCeSYXqsfz76pHgUzw",
              "allocatedMinor": 5000,
              "capturedMinor": 5000,
              "refundedMinor": 0,
              "sortOrder": 2,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.138Z",
              "updatedAt": "2026-02-25T16:38:52.138Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "intent_line_alloc_3AAZrLxf5GZagWy5fp1gGdwfJcS",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentIntentTenderId": "intent_tender_3AAZrMN0fH0NemUeBtDYDreOBNv",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "bookingOrderLineId": "booking_line_3AAZrHzDVwHhOUPi0buwJC0HB6m",
              "allocatedMinor": 500,
              "capturedMinor": 500,
              "refundedMinor": 0,
              "sortOrder": 3,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.138Z",
              "updatedAt": "2026-02-25T16:38:52.138Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ],
          "transactions": [
            {
              "id": "payment_txn_3AAZrJCIeQfyU8VnhlC7ybvZ2M4",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "crossBizOrderId": null,
              "paymentIntentTenderId": "intent_tender_3AAZrH0zltb2AmQtJq17qr1ViZX",
              "paymentMethodId": "payment_method_3AAZrGEm9bJlXrOe7KED0qaKorC",
              "paymentProcessorAccountId": "pay_proc_account_3AAZrJp5Tw0mDwHf4220vU6Kkxz",
              "giftInstrumentId": null,
              "type": "charge",
              "status": "succeeded",
              "amountMinor": 10000,
              "currency": "USD",
              "providerTransactionRef": null,
              "idempotencyKey": null,
              "occurredAt": "2026-02-25T16:38:52.143Z",
              "failureReason": null,
              "providerPayload": {
                "source": "simulated_advanced_checkout"
              },
              "metadata": {
                "tenderIndex": 0
              },
              "createdAt": "2026-02-25T16:38:52.143Z",
              "updatedAt": "2026-02-25T16:38:52.143Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "payment_txn_3AAZrGWMVJseLgOODDeFmQBtHYV",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "crossBizOrderId": null,
              "paymentIntentTenderId": "intent_tender_3AAZrMN0fH0NemUeBtDYDreOBNv",
              "paymentMethodId": "payment_method_3AAZrKFardwNVksqNByD8gt1CGN",
              "paymentProcessorAccountId": "pay_proc_account_3AAZrJp5Tw0mDwHf4220vU6Kkxz",
              "giftInstrumentId": null,
              "type": "charge",
              "status": "succeeded",
              "amountMinor": 5500,
              "currency": "USD",
              "providerTransactionRef": null,
              "idempotencyKey": null,
              "occurredAt": "2026-02-25T16:38:52.143Z",
              "failureReason": null,
              "providerPayload": {
                "source": "simulated_advanced_checkout"
              },
              "metadata": {
                "tenderIndex": 1
              },
              "createdAt": "2026-02-25T16:38:52.143Z",
              "updatedAt": "2026-02-25T16:38:52.143Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ],
          "transactionLineAllocations": [
            {
              "id": "txn_line_alloc_3AAZrGdIrbpwhIBhbICb36YMTjg",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentTransactionId": "payment_txn_3AAZrGWMVJseLgOODDeFmQBtHYV",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentIntentTenderId": "intent_tender_3AAZrMN0fH0NemUeBtDYDreOBNv",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "bookingOrderLineId": "booking_line_3AAZrHzDVwHhOUPi0buwJC0HB6m",
              "paymentIntentLineAllocationId": "intent_line_alloc_3AAZrLxf5GZagWy5fp1gGdwfJcS",
              "amountMinor": 500,
              "occurredAt": "2026-02-25T16:38:52.149Z",
              "idempotencyKey": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.149Z",
              "updatedAt": "2026-02-25T16:38:52.149Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "txn_line_alloc_3AAZrHfB3Lrous7Wr0IcRgbVaaG",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentTransactionId": "payment_txn_3AAZrJCIeQfyU8VnhlC7ybvZ2M4",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentIntentTenderId": "intent_tender_3AAZrH0zltb2AmQtJq17qr1ViZX",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "bookingOrderLineId": "booking_line_3AAZrNPqnuCeSYXqsfz76pHgUzw",
              "paymentIntentLineAllocationId": "intent_line_alloc_3AAZrGoZ2PutPqAbixIbX381z3w",
              "amountMinor": 10000,
              "occurredAt": "2026-02-25T16:38:52.149Z",
              "idempotencyKey": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.149Z",
              "updatedAt": "2026-02-25T16:38:52.149Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "txn_line_alloc_3AAZrHEX3VmcXnhGQK7qL3Moijv",
              "bizId": "3AAZqc9VQhE50e7Dx8433kahhOP",
              "paymentTransactionId": "payment_txn_3AAZrGWMVJseLgOODDeFmQBtHYV",
              "paymentIntentId": "payment_intent_3AAZrM3cyO30EvSwH1zuctXLbVM",
              "paymentIntentTenderId": "intent_tender_3AAZrMN0fH0NemUeBtDYDreOBNv",
              "bookingOrderId": "booking_order_3AAZrDDgxpeIWFdGOSy1KA7DcPy",
              "bookingOrderLineId": "booking_line_3AAZrNPqnuCeSYXqsfz76pHgUzw",
              "paymentIntentLineAllocationId": "intent_line_alloc_3AAZrM1DCzx6YnsXNNzALlILNM4",
              "amountMinor": 5000,
              "occurredAt": "2026-02-25T16:38:52.149Z",
              "idempotencyKey": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:38:52.149Z",
              "updatedAt": "2026-02-25T16:38:52.149Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ]
        },
        "meta": {
          "requestId": "e673bd77-aac3-4087-813e-19927e93812d",
          "timestamp": "2026-02-25T16:38:52.193Z"
        }
      },
      "at": "2026-02-25T16:38:52.194Z"
    }
  ]
}
