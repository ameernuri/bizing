{
  "stepKey": "customer-advanced-payment-flow",
  "callCount": 3,
  "calls": [
    {
      "method": "POST",
      "path": "/api/v1/public/bizes/3AAYnUgLANj8MNG41FCcE18xCLj/booking-orders/booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do/payments/advanced",
      "status": 201,
      "requestBody": {
        "tipMinor": 500,
        "tenders": [
          {
            "methodType": "card",
            "allocatedMinor": 10000,
            "label": "Primary card"
          },
          {
            "methodType": "cash",
            "allocatedMinor": 5500,
            "label": "Cash supplement"
          }
        ],
        "metadata": {
          "source": "rerun-sagas"
        }
      },
      "responseBody": {
        "success": true,
        "data": {
          "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
          "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
          "status": "succeeded",
          "currency": "USD",
          "amountTargetMinor": 15500,
          "amountCapturedMinor": 15500,
          "tenderCount": 2,
          "lineAllocationCount": 3,
          "transactionCount": 2
        },
        "meta": {
          "requestId": "200541eb-1da9-4180-9359-624a991f1f7f",
          "timestamp": "2026-02-25T16:30:13.390Z"
        }
      },
      "at": "2026-02-25T16:30:13.390Z"
    },
    {
      "method": "GET",
      "path": "/api/v1/bizes/3AAYnUgLANj8MNG41FCcE18xCLj/payment-intents?bookingOrderId=booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
      "status": 200,
      "responseBody": {
        "success": true,
        "data": [
          {
            "id": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
            "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
            "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
            "crossBizOrderId": null,
            "paymentProcessorAccountId": "pay_proc_account_3AAYo8W361P0Twa0nDWSEeBejdv",
            "status": "succeeded",
            "currency": "USD",
            "amountTargetMinor": 15500,
            "amountCapturedMinor": 15500,
            "amountRefundedMinor": 0,
            "requiresCapture": false,
            "providerIntentRef": null,
            "source": "public_checkout",
            "authorizedAt": null,
            "capturedAt": "2026-02-25T16:30:13.251Z",
            "failedAt": null,
            "amountSnapshot": {
              "tipMinor": 500,
              "bookingTotalMinor": 15000,
              "expectedTotalMinor": 15500
            },
            "metadata": {
              "source": "rerun-sagas"
            },
            "createdAt": "2026-02-25T16:30:13.252Z",
            "updatedAt": "2026-02-25T16:30:13.252Z",
            "deletedAt": null,
            "createdBy": null,
            "updatedBy": null,
            "deletedBy": null
          }
        ],
        "meta": {
          "requestId": "c61aa5e7-3692-48b7-8853-336fc6a05bab",
          "timestamp": "2026-02-25T16:30:13.403Z"
        },
        "pagination": {
          "page": 1,
          "perPage": 20,
          "total": 1,
          "hasMore": false
        }
      },
      "at": "2026-02-25T16:30:13.403Z"
    },
    {
      "method": "GET",
      "path": "/api/v1/bizes/3AAYnUgLANj8MNG41FCcE18xCLj/payment-intents/payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
      "status": 200,
      "responseBody": {
        "success": true,
        "data": {
          "intent": {
            "id": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
            "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
            "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
            "crossBizOrderId": null,
            "paymentProcessorAccountId": "pay_proc_account_3AAYo8W361P0Twa0nDWSEeBejdv",
            "status": "succeeded",
            "currency": "USD",
            "amountTargetMinor": 15500,
            "amountCapturedMinor": 15500,
            "amountRefundedMinor": 0,
            "requiresCapture": false,
            "providerIntentRef": null,
            "source": "public_checkout",
            "authorizedAt": null,
            "capturedAt": "2026-02-25T16:30:13.251Z",
            "failedAt": null,
            "amountSnapshot": {
              "tipMinor": 500,
              "bookingTotalMinor": 15000,
              "expectedTotalMinor": 15500
            },
            "metadata": {
              "source": "rerun-sagas"
            },
            "createdAt": "2026-02-25T16:30:13.252Z",
            "updatedAt": "2026-02-25T16:30:13.252Z",
            "deletedAt": null,
            "createdBy": null,
            "updatedBy": null,
            "deletedBy": null
          },
          "tenders": [
            {
              "id": "intent_tender_3AAYo9DJZQUEByS8Ktd2wPhpDAN",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentMethodId": "payment_method_3AAYo80GEHUYNv31OLTaf0oSOCn",
              "giftInstrumentId": null,
              "methodType": "card",
              "allocatedMinor": 10000,
              "capturedMinor": 10000,
              "refundedMinor": 0,
              "sortOrder": 1,
              "externalTenderRef": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.268Z",
              "updatedAt": "2026-02-25T16:30:13.268Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "intent_tender_3AAYo3as9RHyN7FyBVhkJTI0hhv",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentMethodId": "payment_method_3AAYo7RoBWGGosOfFz2sjICKUEK",
              "giftInstrumentId": null,
              "methodType": "cash",
              "allocatedMinor": 5500,
              "capturedMinor": 5500,
              "refundedMinor": 0,
              "sortOrder": 2,
              "externalTenderRef": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.377Z",
              "updatedAt": "2026-02-25T16:30:13.377Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ],
          "lineAllocations": [
            {
              "id": "intent_line_alloc_3AAYo32TaUU5D0qD0iX91AB3bXV",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentIntentTenderId": "intent_tender_3AAYo9DJZQUEByS8Ktd2wPhpDAN",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "bookingOrderLineId": "booking_line_3AAYo2k8TNxQd0m0URVSehr4hCG",
              "allocatedMinor": 10000,
              "capturedMinor": 10000,
              "refundedMinor": 0,
              "sortOrder": 1,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.379Z",
              "updatedAt": "2026-02-25T16:30:13.379Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "intent_line_alloc_3AAYo44nifUaVwLH8SDUu3Xreb3",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentIntentTenderId": "intent_tender_3AAYo3as9RHyN7FyBVhkJTI0hhv",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "bookingOrderLineId": "booking_line_3AAYo2k8TNxQd0m0URVSehr4hCG",
              "allocatedMinor": 5000,
              "capturedMinor": 5000,
              "refundedMinor": 0,
              "sortOrder": 2,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.379Z",
              "updatedAt": "2026-02-25T16:30:13.379Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "intent_line_alloc_3AAYo4mUzoyEV0TyQrvhNRhGWy4",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentIntentTenderId": "intent_tender_3AAYo3as9RHyN7FyBVhkJTI0hhv",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "bookingOrderLineId": "booking_line_3AAYo7cdWHJAKs5mo5vK6i0i6ei",
              "allocatedMinor": 500,
              "capturedMinor": 500,
              "refundedMinor": 0,
              "sortOrder": 3,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.379Z",
              "updatedAt": "2026-02-25T16:30:13.379Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ],
          "transactions": [
            {
              "id": "payment_txn_3AAYo88542R5N9HatvmD7Ocz26r",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "crossBizOrderId": null,
              "paymentIntentTenderId": "intent_tender_3AAYo9DJZQUEByS8Ktd2wPhpDAN",
              "paymentMethodId": "payment_method_3AAYo80GEHUYNv31OLTaf0oSOCn",
              "paymentProcessorAccountId": "pay_proc_account_3AAYo8W361P0Twa0nDWSEeBejdv",
              "giftInstrumentId": null,
              "type": "charge",
              "status": "succeeded",
              "amountMinor": 10000,
              "currency": "USD",
              "providerTransactionRef": null,
              "idempotencyKey": null,
              "occurredAt": "2026-02-25T16:30:13.382Z",
              "failureReason": null,
              "providerPayload": {
                "source": "simulated_advanced_checkout"
              },
              "metadata": {
                "tenderIndex": 0
              },
              "createdAt": "2026-02-25T16:30:13.382Z",
              "updatedAt": "2026-02-25T16:30:13.382Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "payment_txn_3AAYo9wTUiJ17YRKuzMQsnZMq6t",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "crossBizOrderId": null,
              "paymentIntentTenderId": "intent_tender_3AAYo3as9RHyN7FyBVhkJTI0hhv",
              "paymentMethodId": "payment_method_3AAYo7RoBWGGosOfFz2sjICKUEK",
              "paymentProcessorAccountId": "pay_proc_account_3AAYo8W361P0Twa0nDWSEeBejdv",
              "giftInstrumentId": null,
              "type": "charge",
              "status": "succeeded",
              "amountMinor": 5500,
              "currency": "USD",
              "providerTransactionRef": null,
              "idempotencyKey": null,
              "occurredAt": "2026-02-25T16:30:13.382Z",
              "failureReason": null,
              "providerPayload": {
                "source": "simulated_advanced_checkout"
              },
              "metadata": {
                "tenderIndex": 1
              },
              "createdAt": "2026-02-25T16:30:13.382Z",
              "updatedAt": "2026-02-25T16:30:13.382Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ],
          "transactionLineAllocations": [
            {
              "id": "txn_line_alloc_3AAYo9UnhDFKx8nsAUU2NhUDLv3",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentTransactionId": "payment_txn_3AAYo88542R5N9HatvmD7Ocz26r",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentIntentTenderId": "intent_tender_3AAYo9DJZQUEByS8Ktd2wPhpDAN",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "bookingOrderLineId": "booking_line_3AAYo2k8TNxQd0m0URVSehr4hCG",
              "paymentIntentLineAllocationId": "intent_line_alloc_3AAYo32TaUU5D0qD0iX91AB3bXV",
              "amountMinor": 10000,
              "occurredAt": "2026-02-25T16:30:13.386Z",
              "idempotencyKey": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.386Z",
              "updatedAt": "2026-02-25T16:30:13.386Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "txn_line_alloc_3AAYoA0FkkUyIl5FXDTIzCWsgsH",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentTransactionId": "payment_txn_3AAYo9wTUiJ17YRKuzMQsnZMq6t",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentIntentTenderId": "intent_tender_3AAYo3as9RHyN7FyBVhkJTI0hhv",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "bookingOrderLineId": "booking_line_3AAYo2k8TNxQd0m0URVSehr4hCG",
              "paymentIntentLineAllocationId": "intent_line_alloc_3AAYo44nifUaVwLH8SDUu3Xreb3",
              "amountMinor": 5000,
              "occurredAt": "2026-02-25T16:30:13.386Z",
              "idempotencyKey": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.386Z",
              "updatedAt": "2026-02-25T16:30:13.386Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            },
            {
              "id": "txn_line_alloc_3AAYo7jxudtXcgmKxCUHzS1p9q4",
              "bizId": "3AAYnUgLANj8MNG41FCcE18xCLj",
              "paymentTransactionId": "payment_txn_3AAYo9wTUiJ17YRKuzMQsnZMq6t",
              "paymentIntentId": "payment_intent_3AAYo4qHOlu4Ls3dUGV7t4j6Nrv",
              "paymentIntentTenderId": "intent_tender_3AAYo3as9RHyN7FyBVhkJTI0hhv",
              "bookingOrderId": "booking_order_3AAYnypem7A5cV3n3kxDMOcx5Do",
              "bookingOrderLineId": "booking_line_3AAYo7cdWHJAKs5mo5vK6i0i6ei",
              "paymentIntentLineAllocationId": "intent_line_alloc_3AAYo4mUzoyEV0TyQrvhNRhGWy4",
              "amountMinor": 500,
              "occurredAt": "2026-02-25T16:30:13.386Z",
              "idempotencyKey": null,
              "metadata": {},
              "createdAt": "2026-02-25T16:30:13.386Z",
              "updatedAt": "2026-02-25T16:30:13.386Z",
              "deletedAt": null,
              "createdBy": null,
              "updatedBy": null,
              "deletedBy": null
            }
          ]
        },
        "meta": {
          "requestId": "30df1a8a-fa77-48f7-8cd7-8501569a44db",
          "timestamp": "2026-02-25T16:30:13.418Z"
        }
      },
      "at": "2026-02-25T16:30:13.419Z"
    }
  ]
}
